<!DOCTYPE html>
<html>
  <head>
    <title>Commit Analyzing Service</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='//fonts.googleapis.com/css?family=Roboto:100,300' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.0-rc.2/angular.js"></script>
   <!--SCRIPTS-->
   <script src="/linker/js/socket.io.js"></script>
   <script src="/linker/js/sails.io.js"></script>
   <script src="/linker/js/app.js"></script>
   <script src="/linker/js/angular-route.js"></script>
   <!--SCRIPTS END-->

<!--STYLES-->
<link rel="stylesheet" href="/linker/styles/app.css">
<!--STYLES END-->

<!--TEMPLATES-->

<!--TEMPLATES END-->
   
    <script>
      if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
  var msViewportStyle = document.createElement("style")
  msViewportStyle.appendChild(
    document.createTextNode(
      "@-ms-viewport{width:auto!important}"
    )
  )
  document.getElementsByTagName("head")[0].appendChild(msViewportStyle)
}
    </script>
  </head>

  <body ng-app="casweb" ng-controller="AppCtrl">
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation" ng-controller="NavbarCtrl">
  <div class="container">
	  <div class="navbar-header">
	    <button type="button" class="navbar-toggle" ng-click="collapse = !collapse">
	      <span class="sr-only">Toggle navigation</span>
	      <span class="icon-bar"></span>
	      <span class="icon-bar"></span>
	      <span class="icon-bar"></span>
	    </button>
	    <a class="navbar-brand" href="/" ng-click="collapse = 0"><span class="glyphicon glyphicon-flag"></span> CAS</a>
	  </div>
	
	  <!-- Collect the nav links, forms, and other content for toggling -->
	  <div class="collapse navbar-collapse navbar-ex1-collapse" ng-class="{in: collapse}">
	    <ul class="nav navbar-nav">
	      <li ng-class="{ active: currentPage('/')}"><a href="/" ng-click="collapse = 0"><b class="glyphicon  glyphicon-home"></b> Home</a></li>
	      <li ng-class="{ active: (currentPage('/repos')|| currentPage('/repo'))}"><a href="/repos" ng-click="collapse = 0"><b class="glyphicon glyphicon-asterisk"></b> Repos</a></li>
	    </ul>
	  </div>
  </div>
</nav>
	<div id="content">
		<div class="container" id="messages" ng-if="globalMessages.count() > 0">
			<div class="alert alert-{{message.type}} alert-dismissable" ng-repeat="message in globalMessages.get()">
				<button type="button" class="close" ng-click="globalMessages.remove($index)">&times;</button>
				{{message.content}}
			</div>
		</div>
		<div ng-View class="container"></div>
	</div>
	<script type="text/ng-template" id="repository.html">
		<div ng-switch="loaded">
	<div ng-switch-when="true">
		<div class="row">
			<div class="col-md-8">
				<h2>{{repo.name}}</h2>
			</div>
			<div class="col-md-4">
				<p></p>
				<span ng-if="repo.ingestion_date.length > 0">Last Ingested: {{repo.ingestion_date}}</span><span ng-if="repo.analysis_date.length > 0"><br>Last Analyzed: {{repo.analysis_date}}</span>

			</div>
		</div>
		<pre ng-if="debug">{{repo.metrics | json}}</pre>
		<div class="row" ng-show="repoStatus == 'analyzed'">
			<div class="col-md-4">
				<div class="form-group">
					<input type="text" class="form-control" ng-model="search.fulltext" placeholder="Filter commits">
				</div>
			</div>
			<div class="col-md-8">
				<div class="pull-right">
					<div class="form-group">
						<button ng-click="debug = !debug" class="btn btn-danger">Toggle Debug</button>
						<button class="btn btn-default" ng-disabled="currentPage == 0" ng-click="currentPage=currentPage-1">Previous</button>
						{{currentPage+1}}/{{numberOfPages()}}
						<button class="btn btn-default" ng-disabled="currentPage >= commits.length/pageSize - 1" ng-click="currentPage=currentPage+1">Next</button>
					</div>
				</div>
			</div>
		</div>
		<div class="row" ng-show="repoStatus == 'analyzed'">
			<div class="col-md-12">
				
				<div ng-repeat="commit in commits | startFrom:currentPage*pageSize | limitTo:pageSize">
					<div class="panel panel-default" ng-class="{'panel-danger':commit.contains_bug}">
						<div class="panel-heading">
							<div class="pull-right">{{commit.author_name}} on {{commit.author_date}}</div>
							<h3 class="panel-title">
								<span ng-if="commit.contains_bug">Possible Bug-inducing: </span>{{commit.commit_hash}}
							</h3>
						</div>
						<div class="panel-body">
							<h4>
								<div class="row">
									<div class="col-md-2" metric="commit.lt">Lines</div>
									<div class="col-md-2" metric="commit.la">Lines Added</div>
									<div class="col-md-2" metric="commit.ld">Lines Deleted</div>
									<div class="col-md-2" metric="commit.nuc"># of unique changes</div>
									<div class="col-md-2" metric="commit.age">Relative Age</div>
									<div class="col-md-2" metric="commit.ndev"># of Devs</div>
								</div>
							</h4>
							<div class="form-group">
								<button class="btn btn-primary" ng-click="show_commit_message = !show_commit_message" type="button">Toggle Message</button>
								<button class="btn btn-default" ng-click="show_commit_diff = !show_commit_diff" type="button">Toggle Diff</button>
							</div>
							<div class="well" ng-if="show_commit_message">{{commit.commit_message}}</div>
							<div class="well" ng-if="show_commit_diff">
								<i>Not Implimented Yet.</i>
							</div>
						</div>
					</div>
				</div>
				<div ng-if="commits.length == 0">
					<div class="alert alert-warning">No Results</div>
				</div>
			</div>
		</div>
		<div class="row" ng-switch="repoStatus">
			<div class="col-md-6" ng-switch-when="ingested">
				<div class="panel panel-warning">
					<div class="panel-heading">
						<h3 class="panel-title">Repository ingested, wating for analysis...</h3>
					</div>
					<div class="panel-body">The repository was successfully ingested into the system and it is now waiting for analysis. This may take a while -- consider adding your email to the right to get notified when it is finished.</div>
				</div>
			</div>
			<div class="col-md-6" ng-switch-when="uningested">
				<div class="panel panel-warning">
					<div class="panel-heading">
						<h3 class="panel-title">Repository scheduled to be ingested and analyzed</h3>
					</div>
					<div class="panel-body">Please wait for the repository to be ingested in to our system. This may take a while -- consider adding your email to the right to get notified when it is finished.</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<h3 class="panel-title">Add a notification email</h3>
					</div>
					<div class="panel-body">
						<p>Want to get notified when your repository is ready to view?<br><br><strong>Yes?</strong> Then just add your email address below and you will get an email whenever the repository is analyzed.</p>
						<form name="updateEmailForm" class="form-horizontal">
							<div class="form-group">
								<label for="repo-email" class="col-sm-2 control-label">Email</label>
								<div class="col-sm-10">
									<input type="email" name="email" ng-model="repo.email" class="form-control" id="repo-email" placeholder="Email">
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-offset-2 col-sm-10">
									<button type="button" class="btn btn-default" ng-disabled="updateEmailForm.email.$error.email || updateEmailForm.email.$error.required" ng-click="updateEmail()">Save Email</button>
								</div>
							</div>
						</form>
					</div>
				</div>				
			</div>
		</div>
	</div>
	<div class="alert alert-info center" style="margin-top:25px;" ng-switch-when="false">Repository Loading...</div>
</div>
	</script>
						
</body>
</html>
